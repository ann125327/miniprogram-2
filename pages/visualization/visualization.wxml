<view class="visualization-page">
  
  <view class="filter-area">
    <picker mode="selector" range="{{ periods }}" value="{{ periodIndex }}" bindchange="handlePeriodChange">
      <view class="filter-item filter-period">
        <text>{{ currentPeriod }}</text>
        <text class="arrow">▼</text>
      </view>
    </picker>
  </view>

  <view wx:if="{{ isLoading }}" class="loading-mask">
    <text>数据加载中...</text>
  </view>

  <view class="data-cards">
    <view class="card income">
      <text class="label">总收入</text>
      <text class="amount">¥ {{ totalIncome }}</text>
    </view>
    <view class="card expense">
      <text class="label">总支出</text>
      <text class="amount">¥ {{ totalExpense }}</text>
    </view>
  </view>

  <view class="chart-container">
    <view class="chart-title">设置每月预算</view>
    <view class="budget-row">
      <view class="budget-input-box">
        <text class="currency">¥</text>
        <input 
          type="number" 
          class="budget-input" 
          placeholder="当前预算: {{ currentBudget }}" 
          placeholder-style="color: #ccc;"
          bindinput="handleBudgetInput"
          value="{{ inputBudgetValue }}"
        />
      </view>
      <button class="save-btn" size="mini" bindtap="handleSaveBudget">设置</button>
    </view>
  </view>

  <view class="chart-container">
    <view class="chart-title">预算使用</view>
    <gauge-chart 
      actualExpense="{{ expenseValue }}" 
      budget="{{ currentBudget }}">
    </gauge-chart>
  </view>

  <view class="chart-container">
    <view class="chart-title">收支趋势图 (支出)</view>
    <block wx:if="{{ lineChartData.length > 0 }}">
       <line-chart chartData="{{ lineChartData }}"></line-chart>
    </block>
    <view wx:else class="empty-chart">
       <text>本期暂无支出趋势 📉</text>
    </view>
  </view>

  <view class="chart-container">
    <view class="chart-title">分类支出占比</view>
    <block wx:if="{{ pieChartData.length > 0 }}">
      <pie-chart 
        style="width: 100%; height: 400rpx; display: block;"
        chartData="{{ pieChartData }}"
        bind:categoryTap="goToDetail">
      </pie-chart>
    </block>
    <view wx:else class="empty-chart">
      <text>本期暂无支出记录 🍃</text>
    </view>
  </view>
  
  <view class="chart-container">
    <view class="chart-title">分类收入占比</view>
    <block wx:if="{{ incomePieData.length > 0 }}">
      <pie-chart 
        style="width: 100%; height: 400rpx; display: block;"
        chartData="{{ incomePieData }}"
        bind:categoryTap="goToDetail">
      </pie-chart>
    </block>
    <view wx:else class="empty-chart">
      <text>本期暂无收入记录 💰</text>
    </view>
  </view>
  
</view>