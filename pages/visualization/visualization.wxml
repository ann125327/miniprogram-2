<view class="visualization-page">
  
  <view class="custom-header">
    <view class="header-title">收支可视化</view>
  </view>

  <view class="filter-area">
    <picker mode="selector" range="{{ periods }}" value="{{ periodIndex }}" bindchange="handlePeriodChange">
      <view class="filter-item filter-period">
        <text>{{ currentPeriod }}</text>
        <text class="arrow">▼</text>
      </view>
    </picker>
  </view>

  <view wx:if="{{ isLoading }}" class="loading-mask">
    <text>数据加载中...</text>
  </view>

  <view class="data-cards">
    <view class="card income">
      <text class="label">总收入</text>
      <text class="amount">¥ {{ totalIncome }}</text>
    </view>
    <view class="card expense">
      <text class="label">总支出</text>
      <text class="amount">¥ {{ totalExpense }}</text>
    </view>
  </view>

 
  <view class="chart-container budget-input-area">
    <view class="chart-title">设置每月预算</view>
    <view class="input-group">
        <text>¥</text>
        <input 
            class="budget-input"
            type="digit"
            placeholder="{{ '当前预算: ' + currentBudget }}"
            value="{{ newBudgetValue }}"
            bindinput="handleBudgetInput"
        />
        <button 
            class="set-button" 
            bindtap="setNewBudget"
            disabled="{{ !newBudgetValue }}"
        >设置</button>
    </view>
</view>
<view class="chart-container">
    <view class="chart-title">预算使用</view>
    <gauge-chart 
      actualExpense="{{ expenseValue }}" 
      budget="{{ currentBudget }}">
    </gauge-chart>
</view>
  <view class="chart-container">
    <view class="chart-title">收支趋势图 (支出)</view>
    <block wx:if="{{ lineChartData.length > 0 }}">
       <line-chart chartData="{{ lineChartData }}"></line-chart>
    </block>
    <view wx:else class="empty-chart">
       <text>本期暂无支出趋势 📉</text>
    </view>
  </view>

  <view class="chart-container">
    <view class="chart-title">分类支出占比</view>
    <block wx:if="{{ pieChartData.length > 0 }}">
      <pie-chart 
        style="width: 100%; height: 400rpx; display: block;"
        chartData="{{ pieChartData }}"
        bind:categoryTap="goToDetail">
      </pie-chart>
    </block>
    <view wx:else class="empty-chart">
      <text>本期暂无支出记录 🍃</text>
    </view>
  </view>
  
  <view class="chart-container">
    <view class="chart-title">分类收入占比</view>
    <block wx:if="{{ incomePieData.length > 0 }}">
      <pie-chart 
        style="width: 100%; height: 400rpx; display: block;"
        chartData="{{ incomePieData }}"
        bind:categoryTap="goToDetail">
      </pie-chart>
    </block>
    <view wx:else class="empty-chart">
      <text>本期暂无收入记录 💰</text>
    </view>
  </view>
  
</view>